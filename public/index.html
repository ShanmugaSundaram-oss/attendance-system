<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RIT Smart IMS — Institute Management Portal</title>
    <link rel="icon" type="image/png" href="/logo.png">
    <meta name="description"
        content="AI-powered Institute Management System with face recognition attendance, timetable, grades, announcements, and comprehensive analytics.">
    <link rel="stylesheet" href="/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        /* ── Landing Page Styles ── */
        .landing-nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            padding: 1.25rem 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: transparent;
            transition: all .3s ease;
        }

        .landing-nav.scrolled {
            background: rgba(0, 0, 0, .9);
            border-bottom: 1px solid #1a1a1a;
        }

        .nav-brand {
            display: flex;
            align-items: center;
            gap: .75rem;
        }

        .nav-brand-icon img {
            width: 36px;
            height: 36px;
            border-radius: 8px;
        }

        .nav-brand-text {
            font-size: 1.15rem;
            font-weight: 800;
            letter-spacing: 1.5px;
            color: #D4A843;
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        /* Hero */
        .hero {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 5rem 2rem 3rem;
            position: relative;
            background: #000;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 500px;
            height: 500px;
            transform: translate(-50%, -50%);
            background: radial-gradient(circle, rgba(212, 168, 67, 0.06) 0%, transparent 70%);
            border-radius: 50%;
            pointer-events: none;
        }

        .hero-logo {
            width: 80px;
            height: 80px;
            border-radius: 18px;
            margin-bottom: 2rem;
            position: relative;
            z-index: 1;
        }

        .hero-badge {
            display: inline-flex;
            align-items: center;
            gap: .5rem;
            padding: .4rem 1rem;
            border: 1px solid #222;
            border-radius: 50px;
            font-size: .72rem;
            font-weight: 600;
            color: #D4A843;
            margin-bottom: 1.5rem;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .hero-title {
            font-size: clamp(2.5rem, 6vw, 4.5rem);
            font-weight: 900;
            line-height: 1.05;
            margin-bottom: 1rem;
            letter-spacing: -1px;
            color: #fff;
        }

        .hero-title .gold {
            color: #D4A843;
        }

        .hero-subtitle {
            font-size: 1rem;
            color: #666;
            line-height: 1.8;
            max-width: 520px;
            margin: 0 auto 2rem;
        }

        /* Stats Row */
        .stats-row {
            display: flex;
            gap: 3rem;
            justify-content: center;
            margin-bottom: 3rem;
            padding-top: 1rem;
            border-top: 1px solid #1a1a1a;
        }

        .stat-item {
            text-align: center;
        }

        .stat-num {
            font-size: 1.5rem;
            font-weight: 800;
            color: #D4A843;
        }

        .stat-desc {
            font-size: .72rem;
            color: #555;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: .25rem;
        }

        /* Portals */
        .portals-section {
            padding: 4rem 2rem 5rem;
            max-width: 1000px;
            margin: 0 auto;
        }

        .section-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .section-header h2 {
            font-size: 2rem;
            font-weight: 800;
            letter-spacing: -.5px;
        }

        .section-header p {
            color: #555;
            font-size: .9rem;
            margin-top: .5rem;
        }

        .portal-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
        }

        @media (max-width: 900px) {
            .portal-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 500px) {
            .portal-grid {
                grid-template-columns: 1fr;
            }
        }

        .portal-card {
            background: #0a0a0a;
            border: 1px solid #1a1a1a;
            border-radius: 16px;
            padding: 2rem 1.25rem;
            text-align: center;
            cursor: pointer;
            transition: all .3s;
        }

        .portal-card:hover {
            border-color: #333;
            transform: translateY(-4px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, .5);
        }

        .portal-icon {
            width: 56px;
            height: 56px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.4rem;
            color: #000;
            margin: 0 auto 1rem;
        }

        .portal-card h3 {
            font-size: 1rem;
            font-weight: 700;
            margin-bottom: .3rem;
            color: #f5f5f5;
        }

        .portal-card p {
            font-size: .78rem;
            color: #555;
            margin-bottom: 1rem;
            line-height: 1.5;
        }

        .portal-btn {
            display: inline-flex;
            align-items: center;
            gap: .4rem;
            padding: .5rem 1.25rem;
            border-radius: 8px;
            font-size: .78rem;
            font-weight: 600;
            border: 1px solid #D4A843;
            background: transparent;
            color: #D4A843;
            cursor: pointer;
            transition: all .3s;
            width: 100%;
            justify-content: center;
        }

        .portal-btn:hover {
            background: rgba(212, 168, 67, .1);
        }

        /* Features */
        .features-strip {
            padding: 2rem 2rem 4rem;
            max-width: 1000px;
            margin: 0 auto;
        }

        .features-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
        }

        @media (max-width: 700px) {
            .features-row {
                grid-template-columns: 1fr;
            }
        }

        .feature-tile {
            background: #0a0a0a;
            border: 1px solid #1a1a1a;
            border-radius: 14px;
            padding: 1.5rem;
            transition: all .3s;
        }

        .feature-tile:hover {
            border-color: #222;
        }

        .feature-tile-icon {
            width: 42px;
            height: 42px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            margin-bottom: .75rem;
        }

        .feature-tile h3 {
            font-size: .9rem;
            font-weight: 700;
            margin-bottom: .3rem;
        }

        .feature-tile p {
            font-size: .78rem;
            color: #555;
            line-height: 1.6;
        }

        /* Bottom */
        .register-cta {
            text-align: center;
            padding: 1.5rem;
            color: #555;
            font-size: .85rem;
        }

        .register-cta a {
            color: #D4A843;
            font-weight: 600;
            text-decoration: none;
        }

        .register-cta a:hover {
            text-decoration: underline;
        }

        .status-bar {
            max-width: 400px;
            margin: 0 auto 1.5rem;
            padding: .6rem 1rem;
            background: #0a0a0a;
            border: 1px solid #1a1a1a;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: .5rem;
            font-size: .78rem;
            color: #555;
        }

        .status-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
        }

        .status-dot.loading {
            background: #f59e0b;
            animation: pulse 2s infinite;
        }

        .status-dot.loaded {
            background: #22c55e;
            animation: none;
        }

        .status-dot.failed {
            background: #ef4444;
            animation: none;
        }

        .landing-footer {
            padding: 2rem;
            text-align: center;
            border-top: 1px solid #111;
            color: #333;
            font-size: .78rem;
        }

        .modal-overlay {
            z-index: 200;
        }

        /* Google Sign-In button */
        .google-btn {
            display: inline-flex;
            align-items: center;
            gap: .75rem;
            padding: .85rem 2rem;
            background: #fff;
            color: #333;
            border: none;
            border-radius: 10px;
            font-family: inherit;
            font-size: .95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all .3s;
            box-shadow: 0 2px 10px rgba(0, 0, 0, .3);
        }

        .google-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, .4);
        }

        .google-btn img {
            width: 20px;
            height: 20px;
        }
    </style>
</head>

<body>
    <!-- Navigation -->
    <nav class="landing-nav" id="landing-nav">
        <div class="nav-brand">
            <div class="nav-brand-icon"><img src="/logo.png" alt="RIT"></div>
            <span class="nav-brand-text">RIT SMART IMS</span>
        </div>
        <div class="nav-right">
            <span style="color:#555;font-size:.85rem;">
                <i class="far fa-clock"></i> <span id="topbar-time"></span>
            </span>
        </div>
    </nav>

    <!-- Hero -->
    <section class="hero">
        <img src="/logo.png" class="hero-logo" alt="RIT Smart IMS">
        <div class="hero-badge"><i class="fas fa-bolt"></i> AI-Powered Institute Management</div>
        <h1 class="hero-title"><span class="gold">RIT</span> Smart IMS</h1>
        <p class="hero-subtitle">
            Next-generation Institute Management System with AI face recognition,
            real-time attendance, timetables, grades, and campus analytics.
        </p>

        <div class="stats-row">
            <div class="stat-item">
                <div class="stat-num">AI</div>
                <div class="stat-desc">Face Recognition</div>
            </div>
            <div class="stat-item">
                <div class="stat-num">4+</div>
                <div class="stat-desc">User Portals</div>
            </div>
            <div class="stat-item">
                <div class="stat-num">100%</div>
                <div class="stat-desc">Cloud Synced</div>
            </div>
            <div class="stat-item">
                <div class="stat-num">24/7</div>
                <div class="stat-desc">Always Online</div>
            </div>
        </div>
    </section>

    <!-- Portal Login Cards -->
    <section class="portals-section" id="portals">
        <div class="section-header">
            <h2>Choose Your Portal</h2>
            <p>Select your role to access the system</p>
        </div>
        <div class="portal-grid">
            <div class="portal-card" onclick="openLoginModal('student')">
                <div class="portal-icon" style="background:#D4A843;">
                    <i class="fas fa-user-graduate"></i>
                </div>
                <h3>Student Portal</h3>
                <p>Register face & view attendance records</p>
                <button class="portal-btn"><i class="fas fa-arrow-right"></i> Student Login</button>
            </div>
            <div class="portal-card" onclick="openLoginModal('teacher')">
                <div class="portal-icon" style="background:#22c55e;">
                    <i class="fas fa-chalkboard-teacher"></i>
                </div>
                <h3>Teacher Portal</h3>
                <p>Scan faces, mark attendance & analytics</p>
                <button class="portal-btn"><i class="fas fa-arrow-right"></i> Teacher Login</button>
            </div>
            <div class="portal-card" onclick="openLoginModal('admin')">
                <div class="portal-icon" style="background:#3b82f6;">
                    <i class="fas fa-shield-alt"></i>
                </div>
                <h3>Admin Panel</h3>
                <p>Manage users, classes & configuration</p>
                <button class="portal-btn"><i class="fas fa-arrow-right"></i> Admin Login</button>
            </div>
            <div class="portal-card" onclick="openLoginModal('transport')">
                <div class="portal-icon" style="background:#f59e0b;">
                    <i class="fas fa-bus"></i>
                </div>
                <h3>Transport</h3>
                <p>Bus routes, timings & transport notices</p>
                <button class="portal-btn"><i class="fas fa-arrow-right"></i> Transport Login</button>
            </div>
        </div>
    </section>

    <!-- Features -->
    <section class="features-strip" id="features">
        <div class="section-header">
            <h2>Why RIT Smart IMS?</h2>
            <p>Advanced features built for modern institutes</p>
        </div>
        <div class="features-row">
            <div class="feature-tile">
                <div class="feature-tile-icon" style="background:rgba(212,168,67,.12);color:#D4A843;">
                    <i class="fas fa-brain"></i>
                </div>
                <h3>AI Face Recognition</h3>
                <p>Deep learning powered face detection with real-time accuracy using face-api.js.</p>
            </div>
            <div class="feature-tile">
                <div class="feature-tile-icon" style="background:rgba(34,197,94,.12);color:#22c55e;">
                    <i class="fas fa-bolt"></i>
                </div>
                <h3>Instant Tracking</h3>
                <p>Mark attendance in seconds. Auto-duplicate detection prevents double entries.</p>
            </div>
            <div class="feature-tile">
                <div class="feature-tile-icon" style="background:rgba(59,130,246,.12);color:#3b82f6;">
                    <i class="fas fa-chart-pie"></i>
                </div>
                <h3>Analytics & Reports</h3>
                <p>Comprehensive dashboards with attendance trends and exportable reports.</p>
            </div>
        </div>
    </section>

    <!-- Status + Register + Footer -->
    <div class="register-cta">
        <div class="status-bar" id="status-bar">
            <div class="status-dot loading" id="status-dot"></div>
            <span id="status-text">Loading AI models...</span>
        </div>
        <p>Don't have an account? <a href="/register.html">Register here</a></p>
    </div>

    <footer class="landing-footer">
        <p>RIT Smart IMS &copy; 2026 — Institute Management Portal</p>
    </footer>

    <!-- Login Modal -->
    <div class="modal-overlay" id="login-modal">
        <div class="modal">
            <div class="modal-icon" id="modal-icon" style="background: var(--gradient-primary);">
                <i class="fas fa-lock"></i>
            </div>
            <h2 class="modal-title" id="modal-title">Login</h2>
            <p class="modal-subtitle" id="modal-subtitle">Enter your credentials to continue</p>
            <form id="login-form" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label class="form-label"><i class="fas fa-user"
                            style="margin-right:6px;color:#D4A843;"></i>Username</label>
                    <input type="text" id="login-username" class="form-input" placeholder="Enter your username" required
                        autocomplete="username">
                </div>
                <div class="form-group">
                    <label class="form-label"><i class="fas fa-key"
                            style="margin-right:6px;color:#D4A843;"></i>Password</label>
                    <input type="password" id="login-password" class="form-input" placeholder="Enter your password"
                        required autocomplete="current-password">
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-ghost" onclick="closeLoginModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="login-submit-btn">
                        <i class="fas fa-sign-in-alt"></i> Login
                    </button>
                </div>
            </form>

            <!-- Divider -->
            <div style="display:flex;align-items:center;gap:1rem;margin:1.5rem 0 1rem;">
                <div style="flex:1;height:1px;background:#1a1a1a;"></div>
                <span style="font-size:.75rem;color:#555;text-transform:uppercase;letter-spacing:1px;">or</span>
                <div style="flex:1;height:1px;background:#1a1a1a;"></div>
            </div>

            <!-- Google Sign-In via Firebase -->
            <div style="display:flex;justify-content:center;">
                <button class="google-btn" id="firebase-google-btn" onclick="firebaseGoogleSignIn()">
                    <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="G">
                    Sign in with Google
                </button>
            </div>
            <p style="text-align:center;font-size:.7rem;color:#444;margin-top:.75rem;">Only @ritchennai.edu.in emails
                are allowed</p>
            <p style="text-align:center;margin-top:1rem;font-size:.85rem;">
                Don't have an account? <a href="/register.html"
                    style="color:var(--primary-400);text-decoration:none;font-weight:600;">Register Now</a>
            </p>
        </div>
    </div>

    <!-- Firebase CDN -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script>
    <script src="/app.js"></script>
    <script>
        // Initialize Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDecN8y5wLIrOY_WaaiHBBvfGMPQkB1NGA",
            authDomain: "rit-smart-ims.firebaseapp.com",
            projectId: "rit-smart-ims",
            storageBucket: "rit-smart-ims.firebasestorage.app",
            messagingSenderId: "702954585725",
            appId: "1:702954585725:web:970a823fc459d8617ffb14"
        };
        firebase.initializeApp(firebaseConfig);

        let loginUserType = 'student';

        window.addEventListener('scroll', () => {
            document.getElementById('landing-nav').classList.toggle('scrolled', window.scrollY > 40);
        });

        function openLoginModal(type) {
            loginUserType = type;
            const modal = document.getElementById('login-modal');
            const icon = document.getElementById('modal-icon');
            const title = document.getElementById('modal-title');
            const subtitle = document.getElementById('modal-subtitle');

            const config = {
                student: { title: 'Student Login', sub: 'Access your attendance dashboard', icon: 'fa-user-graduate', bg: 'linear-gradient(135deg,#D4A843,#a07d1f)' },
                teacher: { title: 'Teacher Login', sub: 'Access the attendance scanner & analytics', icon: 'fa-chalkboard-teacher', bg: 'linear-gradient(135deg,#22c55e,#16a34a)' },
                admin: { title: 'Admin Login', sub: 'Access system administration panel', icon: 'fa-shield-alt', bg: 'linear-gradient(135deg,#3b82f6,#2563eb)' },
                transport: { title: 'Transport Login', sub: 'Manage bus routes & transport notices', icon: 'fa-bus', bg: 'linear-gradient(135deg,#f59e0b,#d97706)' }
            };

            const c = config[type];
            title.textContent = c.title;
            subtitle.textContent = c.sub;
            icon.style.background = c.bg;
            icon.innerHTML = `<i class="fas ${c.icon}"></i>`;

            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
            setTimeout(() => document.getElementById('login-username').focus(), 300);
        }

        function closeLoginModal() {
            document.getElementById('login-modal').classList.remove('active');
            document.body.style.overflow = '';
            document.getElementById('login-form').reset();
        }

        document.getElementById('login-modal').addEventListener('click', e => {
            if (e.target === e.currentTarget) closeLoginModal();
        });
        document.addEventListener('keydown', e => { if (e.key === 'Escape') closeLoginModal(); });

        async function handleLogin(e) {
            e.preventDefault();
            const username = document.getElementById('login-username').value.trim();
            const password = document.getElementById('login-password').value;
            const btn = document.getElementById('login-submit-btn');

            btn.disabled = true;
            btn.innerHTML = '<div class="spinner"></div> Signing in...';

            const result = await Auth.attemptLogin(username, password, loginUserType);

            if (result.success) {
                Toast.success(`Welcome, ${username}!`);
                const redirectMap = { student: '/student.html', teacher: '/teacher.html', admin: '/admin.html', transport: '/transport.html' };
                setTimeout(() => { window.location.href = redirectMap[loginUserType]; }, 600);
            } else {
                Toast.error(result.message || 'Invalid credentials.');
                document.getElementById('login-password').value = '';
                document.getElementById('login-password').focus();
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-sign-in-alt"></i> Login';
            }
        }

        (function checkExistingSession() {
            if (Auth.isLoggedIn()) {
                const type = Auth.getUserType();
                const rMap = { student: '/student.html', teacher: '/teacher.html', admin: '/admin.html', transport: '/transport.html' };
                if (rMap[type]) window.location.href = rMap[type];
            }
        })();

        startClock('topbar-time');

        FaceModels.load().then(success => {
            const dot = document.getElementById('status-dot');
            const text = document.getElementById('status-text');
            if (success) { dot.className = 'status-dot loaded'; text.textContent = 'AI models loaded — System ready'; }
            else { dot.className = 'status-dot failed'; text.textContent = 'AI models unavailable — Basic mode active'; }
        });

        setTimeout(() => {
            if (FaceModels.loading) {
                document.getElementById('status-dot').className = 'status-dot failed';
                document.getElementById('status-text').textContent = 'Model loading slow — Basic mode active';
            }
        }, 8000);

        // Firebase Google Sign-In
        async function firebaseGoogleSignIn() {
            const btn = document.getElementById('firebase-google-btn');
            btn.disabled = true;
            btn.innerHTML = '<div class="spinner" style="border-top-color:#333;"></div> Signing in...';

            try {
                const provider = new firebase.auth.GoogleAuthProvider();
                provider.setCustomParameters({ hd: 'ritchennai.edu.in' });
                const result = await firebase.auth().signInWithPopup(provider);
                const user = result.user;

                console.log('Firebase user:', user.email, user.displayName);

                // Send user info to our server
                const userInfo = {
                    email: user.email,
                    displayName: user.displayName,
                    photoURL: user.photoURL,
                    uid: user.uid
                };

                const authResult = await Auth.firebaseLogin(userInfo, loginUserType);
                console.log('Auth result:', authResult);

                if (authResult.success) {
                    closeLoginModal();
                    Toast.success(`Welcome, ${authResult.user?.firstName || authResult.user?.username || user.displayName}!`);
                    const role = authResult.user?.role || loginUserType;
                    const redirectMap = { student: '/student.html', teacher: '/teacher.html', admin: '/admin.html', transport: '/transport.html' };
                    const target = redirectMap[role] || '/student.html';
                    setTimeout(() => { window.location.href = target; }, 500);
                } else {
                    Toast.error(authResult.message || 'Login failed. Please try again.');
                    btn.disabled = false;
                    btn.innerHTML = '<img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="G" style="width:20px;height:20px;"> Sign in with Google';
                }
            } catch (error) {
                console.error('Firebase sign-in error:', error);
                if (error.code !== 'auth/popup-closed-by-user' && error.code !== 'auth/cancelled-popup-request') {
                    Toast.error(error.message || 'Google sign-in failed');
                }
                btn.disabled = false;
                btn.innerHTML = '<img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="G" style="width:20px;height:20px;"> Sign in with Google';
            }
        }
    </script>
</body>

</html>